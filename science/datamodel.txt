# Relational

[1][P] Person
+ id: Number
+ userName: String
+ email: String
+ displayName: String
+ biography: String
+ createdAt: Timestamp

[2][1:N]
Project
+ id: Number
+ ownerId: Number
+ title: String
+ createdAt: Timestamp
+ data: ProjectData/String # json encoded 
+ history: ProjectHistory/String # json encoded

[3][M:N]
ProjectInvolvement # Can be used for both invitations and shared projects
+ projectId: Number PK
+ receiverId: Number PK
+ senderId: Number
+ receiverStatus: InvolvementStatus
+ senderStatus: InvolvementStatus
+ permission: PermissionLevel
+ sentAt: Timestamp
+ acceptedAt: Timestamp
+ interactedAt: Timestamp

[enum] PermissionLevel: String
| "none"
| "view"
| "comment"
| "edit"
| "admin"
| "owner"

[enum] InvolvementStatus: String
| "none"
| "invited"
| "accepted"
| "rejected"

# Project data

## Known primitive (or not so primitive) field types
| "boolean"
| "integer"
| "number"
| "string"
| "enum"
| "timestamp"

## Object types
| "Task"
| "TaskSet"
| "TaskTemplate"

## Fundamental task status
| "unknown"
| "todo"
| "working"
| "finished"
| "rejected"

## Custom task status examples
| "todo": "todo"
| "designing": "working"
| "implementing": "working"
| "testing": "working"
| "deploying": "working"
| "done": "finished"

ProjectHistory
+ head: String # head commit id
+ commits:
  + [value]: ProjectCommit # all about task objects
+ events:
  + [value]: ProjectEvent # all about other stuff, like join/leave project

ProjectCommit
+ id: String # or hash
+ parentId: String
+ authorId: String
+ authorName: String
+ createdAt: Timestamp
+ before: Object # task object tree structure { ... }
+ after: Object # task object tree structure { ... }
  ^ if some key is only in 'after', it's add
  ^ if some key is only in 'before', it's delete
  ^ if some key is in 'before' and 'after', it's update

ProjectEvent
+ id: String
+ type: String
+ description: String
+ createdAt: Timestamp
+ data: Object
  + [key]: String
  + [value]: String

ProjectData
+ title: String
+ description: String
+ createdAt: Timestamp
+ taskObjects: Object
  + [key]: String
  + [value]: Task|Milestone|TaskSet|TaskTemplate
+ comments: Object # comments on task objects
  + [key]: String # task key
  + [value]: Object
    + [key]: String
    + [value]: Comment
+ activities: 
  + [key]: String # person key
  + [value]: Object
    + [key]: String
    + [value]: Activity
+ people: 
  + [key]: String
  + [value]: Person
+ groups: 
  + [key]: String
  + [value]: Group
+ taskStatuses: Object
  + [key]: String # status name
  + [value]: String # fundamental status name
+ taskFields:
  + [key]: String # task object type = Task|Milestone|TaskSet
  + [value]: Object
    + [key]: String "primary"|"secondary"
    + [value]: Object
      + [key]: string
      + [value]: Field

Field
+ name: String
+ type: String
+ editable: Boolean
+ min: Number
+ max: Number
+ pattern: String
+ values: String[]
+ default: Boolean|Number|String|Timestamp

TaskObject
+ id: Number 
+ ownerId: Number
+ groupId: String
+ permissions: ObjectPermissionSet
+ title: String
+ description: String
+ draft: Boolean
+ createdAt: Timestamp

Task extends TaskObject
+ assigned: String[] 
+ status: String
+ taskSetId: Number
+ ... custom fields, like "department"

Milestone extends TaskObject
+ deadlineAt: Timestamp

TaskSet extends TaskObject
+ status: String # fundamental status
+ get assigned: String[] 

TaskTemplate extends TaskObject
+ slots:
  + [key]: String
  + [value]: Field
+ objects:
  + [value]: 
    + [key]: String
    + [value]: 
      + [0]: String "get"|"set"|"const"
      + [1]: String|Any # slot name when [0] is "get" or "set",
                          value when [0] is "const"  

ObjectPermissionSet
+ [key]: String "group"|"everyone" # no "owner" key because 
                                     owner always has full privileges 
+ [value]: String "view"|"comment"|"edit"

Activity 
+ id: Number
+ taskId: Number
+ personId: String
+ startedAt: Timestamp
+ finishedAt: Timestamp

Comment
+ id: Number
+ createdAt: Timestamp
+ authorId: Number
+ text: String

Person
+ id: Number
+ userName: String
+ email: String
+ displayName: String
+ biography: String
+ createdAt: Timestamp
+ permission: PermissionLevel 

Group
+ name: String # identifier
+ displayName: String
+ members: Number[] # person ids

## Assignee selector
"@<userName>" select person with userName 
"@#<groupName>" select group
